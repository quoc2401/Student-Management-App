{% extends 'admin/master.html' %}

{% block body %}
<h1 class="text-center text-info">DANH SÁCH CÁC LỚP</h1>
<br>
<form>
    <input type="text" name="subject" placeholder="Nhập môn học...">
    <input type="number" min="1" max="2" name="semester" placeholder="Nhập học kì...">
    <input type="number" min="2000" name="year" placeholder="Nhập năm học...">
    <input type="submit" value="Thống kê" class="btn btn-info">
</form>
<br>
<div class="container row">
  <div  class="col-md-6">
    <table class="table table-striped table-hover table-responsive">
      <thead>
      <tr>
        <td colspan="5"><h4>Báo cáo tổng kết môn học</h4></td>
      </tr>
      <tr>
        <td colspan="3">Môn: {{request.args.get('subject')}}</td>
        <td >Học kỳ: {{request.args.get('semester')}}</td>
        <td>Năm học: {{request.args.get('year')}}</td>
      </tr>
        <tr>
          <th>Mã lớp</th>
          <th>Lớp</th>
          <th>Sỉ số</th>
          <th>Số lượng đạt</th>
          <th>Tỉ lệ</th>
        </tr>
      </thead>
      <tbody>
        {% for s in stats %}
        <tr>
          <td>{{ s.class_id }}</td>
          <td>{{ s.class_name }}</td>
          <td>{{ s.total }}</td>
          <td>{{ s.total_qualified }}</td>
          <td>{{ s.ratio }}</td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="col-md-5">
    <canvas id="myChart" width="100" height="100"></canvas>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
<!--  lay du lieu bo vao chart js-->
  let labels = [], total = 0, total_qualified = 0, data = [] , colors = [], borderColors = []
  let r, g, b
  {% for s in stats %}
    total += {{s.total}};
    total_qualified += {{s.total_qualified}}
  {% endfor %}

  {% for i in range(2) %}
  <!--    Random mau-->
    r = parseInt(Math.random()*255)
    g = parseInt(Math.random()*255)
    b = parseInt(Math.random()*255)
    colors.push(`rgba(${r}, ${g}, ${b}, 0.2)`)
    borderColors.push(`rgba(${r}, ${g}, ${b}, 1)`)
  {% endfor %}

  labels.push('Rớt')
  labels.push('Đậu')
  data.push(total - total_qualified)
  data.push(total_qualified)

<!--  ve chartjs-->
  window.onload = function() {
      const ctx = document.getElementById('myChart').getContext('2d')

      loadChart(ctx, labels, data, 'doughnut', colors, borderColors, 'Thống kê đậu rớt môn học')
  }
</script>
{% endblock %}